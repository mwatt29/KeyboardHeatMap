<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyboard Heatmap Visualizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stats {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            min-width: 120px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .keyboard-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .keyboard {
            display: grid;
            gap: 4px;
            max-width: 800px;
        }

        .keyboard-row {
            display: flex;
            gap: 4px;
            justify-content: center;
        }

        .key {
            min-width: 40px;
            height: 40px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
        }

        .key:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }

        .key.pressed {
            transform: scale(0.95);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }

        .key-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4757;
            color: white;
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .key-count.visible {
            opacity: 1;
        }

        /* Special key sizes */
        .key.tab { min-width: 60px; }
        .key.capslock { min-width: 70px; }
        .key.shift-left { min-width: 90px; }
        .key.shift-right { min-width: 90px; }
        .key.ctrl { min-width: 60px; }
        .key.alt { min-width: 50px; }
        .key.space { min-width: 200px; }
        .key.enter { min-width: 80px; }
        .key.backspace { min-width: 80px; }

        .legend {
            margin-top: 20px;
            text-align: center;
        }

        .legend-item {
            display: inline-block;
            margin: 0 15px;
            font-size: 0.9rem;
        }

        .legend-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
            vertical-align: middle;
        }

        @media (max-width: 768px) {
            .keyboard-container {
                padding: 15px;
            }
            
            .key {
                min-width: 30px;
                height: 30px;
                font-size: 0.7rem;
            }
            
            .key.space { min-width: 120px; }
            .key.shift-left, .key.shift-right { min-width: 60px; }
            .key.enter, .key.backspace { min-width: 50px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Keyboard Heatmap Visualizer</h1>
        <p>Start typing to see your keyboard usage patterns come to life!</p>
    </div>

    <div class="controls">
        <button class="btn" onclick="resetData()">Reset Data</button>
        <button class="btn" onclick="toggleHeatmap()">Toggle Heatmap</button>
        <button class="btn" onclick="exportData()">Export Data</button>
    </div>

    <div class="stats">
        <div class="stat-card">
            <div class="stat-number" id="totalKeys">0</div>
            <div class="stat-label">Total Keys</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="uniqueKeys">0</div>
            <div class="stat-label">Unique Keys</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="mostPressed">-</div>
            <div class="stat-label">Most Pressed</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="wpm">0</div>
            <div class="stat-label">WPM</div>
        </div>
    </div>

    <div class="keyboard-container">
        <div class="keyboard">
            <!-- Row 1 -->
            <div class="keyboard-row">
                <div class="key" data-key="`">~</div>
                <div class="key" data-key="1">1</div>
                <div class="key" data-key="2">2</div>
                <div class="key" data-key="3">3</div>
                <div class="key" data-key="4">4</div>
                <div class="key" data-key="5">5</div>
                <div class="key" data-key="6">6</div>
                <div class="key" data-key="7">7</div>
                <div class="key" data-key="8">8</div>
                <div class="key" data-key="9">9</div>
                <div class="key" data-key="0">0</div>
                <div class="key" data-key="-">-</div>
                <div class="key" data-key="=">=</div>
                <div class="key backspace" data-key="Backspace">⌫</div>
            </div>
            
            <!-- Row 2 -->
            <div class="keyboard-row">
                <div class="key tab" data-key="Tab">Tab</div>
                <div class="key" data-key="q">Q</div>
                <div class="key" data-key="w">W</div>
                <div class="key" data-key="e">E</div>
                <div class="key" data-key="r">R</div>
                <div class="key" data-key="t">T</div>
                <div class="key" data-key="y">Y</div>
                <div class="key" data-key="u">U</div>
                <div class="key" data-key="i">I</div>
                <div class="key" data-key="o">O</div>
                <div class="key" data-key="p">P</div>
                <div class="key" data-key="[">[</div>
                <div class="key" data-key="]">]</div>
                <div class="key" data-key="\">\</div>
            </div>
            
            <!-- Row 3 -->
            <div class="keyboard-row">
                <div class="key capslock" data-key="CapsLock">Caps</div>
                <div class="key" data-key="a">A</div>
                <div class="key" data-key="s">S</div>
                <div class="key" data-key="d">D</div>
                <div class="key" data-key="f">F</div>
                <div class="key" data-key="g">G</div>
                <div class="key" data-key="h">H</div>
                <div class="key" data-key="j">J</div>
                <div class="key" data-key="k">K</div>
                <div class="key" data-key="l">L</div>
                <div class="key" data-key=";">;</div>
                <div class="key" data-key="'">'</div>
                <div class="key enter" data-key="Enter">Enter</div>
            </div>
            
            <!-- Row 4 -->
            <div class="keyboard-row">
                <div class="key shift-left" data-key="ShiftLeft">Shift</div>
                <div class="key" data-key="z">Z</div>
                <div class="key" data-key="x">X</div>
                <div class="key" data-key="c">C</div>
                <div class="key" data-key="v">V</div>
                <div class="key" data-key="b">B</div>
                <div class="key" data-key="n">N</div>
                <div class="key" data-key="m">M</div>
                <div class="key" data-key=",">,</div>
                <div class="key" data-key=".">.</div>
                <div class="key" data-key="/">/</div>
                <div class="key shift-right" data-key="ShiftRight">Shift</div>
            </div>
            
            <!-- Row 5 -->
            <div class="keyboard-row">
                <div class="key ctrl" data-key="ControlLeft">Ctrl</div>
                <div class="key alt" data-key="AltLeft">Alt</div>
                <div class="key space" data-key=" ">Space</div>
                <div class="key alt" data-key="AltRight">Alt</div>
                <div class="key ctrl" data-key="ControlRight">Ctrl</div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <span class="legend-color" style="background: rgba(255, 255, 255, 0.1);"></span>
                No usage
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #3498db;"></span>
                Low usage
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #f39c12;"></span>
                Medium usage
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #e74c3c;"></span>
                High usage
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let keyPressData = {};
        let totalKeyPresses = 0;
        let heatmapEnabled = true;
        let startTime = Date.now();
        let wordCount = 0;

        // Initialize the application
        function init() {
            // Focus on the body to ensure we capture all keystrokes
            document.body.focus();
            document.body.setAttribute('tabindex', '0');
            
            // Add event listeners
            document.addEventListener('keydown', handleKeyPress);
            document.addEventListener('keyup', handleKeyUp);
            
            // Prevent default for some keys to avoid navigation
            document.addEventListener('keydown', (e) => {
                if (['Tab', 'Space'].includes(e.key) || 
                    (e.ctrlKey && ['s', 'r', 'f'].includes(e.key.toLowerCase()))) {
                    e.preventDefault();
                }
            });
            
            updateStats();
        }

        // Handle key press events
        function handleKeyPress(e) {
            const key = normalizeKey(e.key, e.code);
            
            // Update data
            keyPressData[key] = (keyPressData[key] || 0) + 1;
            totalKeyPresses++;
            
            // Count words (rough estimate)
            if (key === ' ' || key === 'Enter') {
                wordCount++;
            }
            
            // Visual feedback
            const keyElement = findKeyElement(key);
            if (keyElement) {
                keyElement.classList.add('pressed');
                updateKeyVisual(keyElement, key);
            }
            
            updateStats();
        }

        function handleKeyUp(e) {
            const key = normalizeKey(e.key, e.code);
            const keyElement = findKeyElement(key);
            if (keyElement) {
                keyElement.classList.remove('pressed');
            }
        }

        // Normalize key names for consistency
        function normalizeKey(key, code) {
            // Handle special cases
            const keyMap = {
                'Control': code === 'ControlLeft' ? 'ControlLeft' : 'ControlRight',
                'Shift': code === 'ShiftLeft' ? 'ShiftLeft' : 'ShiftRight',
                'Alt': code === 'AltLeft' ? 'AltLeft' : 'AltRight',
                ' ': ' ', // Space
                'ArrowUp': '↑',
                'ArrowDown': '↓',
                'ArrowLeft': '←',
                'ArrowRight': '→'
            };
            
            return keyMap[key] || key.toLowerCase();
        }

        // Find the corresponding key element
        function findKeyElement(key) {
            // Direct match
            let element = document.querySelector(`[data-key="${key}"]`);
            if (element) return element;
            
            // Try alternative matches
            const alternatives = {
                'ControlLeft': '[data-key="ControlLeft"]',
                'ControlRight': '[data-key="ControlRight"]',
                'ShiftLeft': '[data-key="ShiftLeft"]',
                'ShiftRight': '[data-key="ShiftRight"]',
                'AltLeft': '[data-key="AltLeft"]',
                'AltRight': '[data-key="AltRight"]',
                ' ': '[data-key=" "]'
            };
            
            if (alternatives[key]) {
                return document.querySelector(alternatives[key]);
            }
            
            return null;
        }

        // Update key visual appearance
        function updateKeyVisual(keyElement, key) {
            const count = keyPressData[key] || 0;
            
            // Update counter
            let counter = keyElement.querySelector('.key-count');
            if (!counter) {
                counter = document.createElement('div');
                counter.className = 'key-count';
                keyElement.appendChild(counter);
            }
            
            counter.textContent = count;
            counter.classList.add('visible');
            
            // Update heatmap colors
            if (heatmapEnabled) {
                updateHeatmapColor(keyElement, count);
            }
        }

        // Update heatmap colors based on usage
        function updateHeatmapColor(keyElement, count) {
            const maxCount = Math.max(...Object.values(keyPressData));
            const intensity = maxCount > 0 ? count / maxCount : 0;
            
            let color;
            if (intensity === 0) {
                color = 'rgba(255, 255, 255, 0.1)';
            } else if (intensity < 0.3) {
                color = `rgba(52, 152, 219, ${0.3 + intensity * 0.7})`;
            } else if (intensity < 0.7) {
                color = `rgba(243, 156, 18, ${0.3 + intensity * 0.7})`;
            } else {
                color = `rgba(231, 76, 60, ${0.3 + intensity * 0.7})`;
            }
            
            keyElement.style.background = color;
        }

        // Update all heatmap colors
        function updateAllHeatmapColors() {
            if (!heatmapEnabled) return;
            
            Object.keys(keyPressData).forEach(key => {
                const keyElement = findKeyElement(key);
                if (keyElement) {
                    updateHeatmapColor(keyElement, keyPressData[key]);
                }
            });
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalKeys').textContent = totalKeyPresses;
            document.getElementById('uniqueKeys').textContent = Object.keys(keyPressData).length;
            
            // Find most pressed key
            let mostPressed = '-';
            let maxCount = 0;
            Object.entries(keyPressData).forEach(([key, count]) => {
                if (count > maxCount) {
                    maxCount = count;
                    mostPressed = key === ' ' ? 'Space' : key.toUpperCase();
                }
            });
            document.getElementById('mostPressed').textContent = mostPressed;
            
            // Calculate WPM
            const timeElapsed = (Date.now() - startTime) / 1000 / 60; // minutes
            const wpm = timeElapsed > 0 ? Math.round(wordCount / timeElapsed) : 0;
            document.getElementById('wpm').textContent = wpm;
        }

        // Reset all data
        function resetData() {
            keyPressData = {};
            totalKeyPresses = 0;
            wordCount = 0;
            startTime = Date.now();
            
            // Reset visual elements
            document.querySelectorAll('.key').forEach(key => {
                key.style.background = '';
                const counter = key.querySelector('.key-count');
                if (counter) {
                    counter.remove();
                }
            });
            
            updateStats();
        }

        // Toggle heatmap visualization
        function toggleHeatmap() {
            heatmapEnabled = !heatmapEnabled;
            
            if (heatmapEnabled) {
                updateAllHeatmapColors();
            } else {
                document.querySelectorAll('.key').forEach(key => {
                    key.style.background = '';
                });
            }
        }

        // Export data as JSON
        function exportData() {
            const data = {
                keyPressData,
                totalKeyPresses,
                wordCount,
                sessionDuration: Date.now() - startTime,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `keyboard-heatmap-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>